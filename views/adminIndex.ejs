<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>eCommerce Dashboard</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }

    #sidebar {
      background-color: #ffffff;
      color: #fff;
      padding-top: 20px;
    }

    #sidebar a {
      padding: 10px;
      text-decoration: none;
      font-size: 18px;
      color: #000000;
      display: block;
      transition: 0.3s;
    }

    #sidebar a:hover {
      color: #3c01fffe;
    }


    #sidebar .logout {
      color: #fff;
      background-color: #ff0000;
      border-radius: 5px;
      padding: 10px;
      margin-top: 20px;
    }

    #content {
      padding: 20px;
    }

    .dashboard-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 24px;
      margin-bottom: 20px;
    }

    .statistic-box {
      background-color: rgba(171, 194, 194, 0.141);
      border: 1px solid #000000;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
      margin-bottom: 20px;
    }

    .statistic-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .statistic-value {
      font-size: 24px;
      color: #27ae60;
    }

    .statistic-icon {
      font-size: 36px;
      margin-bottom: 10px;
      color: #3498db;
    }


    .button {
      -moz-appearance: none;
      -webkit-appearance: none;
      appearance: none;
      justify-content: center;
      align-items: center;
      border: none;
      background: none;
      color: #0f1923;
      cursor: pointer;
      position: relative;
      padding: 8px;
      margin-bottom: 20px;
      text-transform: uppercase;
      font-weight: bold;
      font-size: 14px;
      transition: all .15s ease;
    }

    .button::before,
    .button::after {
      content: '';
      display: block;
      position: absolute;
      right: 0;
      left: 0;
      height: calc(50% - 5px);
      border: 1px solid #7D8082;
      transition: all .15s ease;
    }

    .button::before {
      top: 0;
      border-bottom-width: 0;
    }

    .button::after {
      bottom: 0;
      border-top-width: 0;
    }

    .button:active,
    .button:focus {
      outline: none;
    }

    .button:active::before,
    .button:active::after {
      right: 3px;
      left: 3px;
    }

    .button:active::before {
      top: 3px;
    }

    .button:active::after {
      bottom: 3px;
    }

    .button_lg {
      position: relative;
      display: block;
      padding: 10px 20px;
      color: #fff;
      background-color: #0f1923;
      overflow: hidden;
      box-shadow: inset 0px 0px 0px 1px transparent;
    }

    .button_lg::before {
      content: '';
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 2px;
      height: 2px;
      background-color: #0f1923;
    }

    .button_lg::after {
      content: '';
      display: block;
      position: absolute;
      right: 0;
      bottom: 0;
      width: 4px;
      height: 4px;
      background-color: #0f1923;
      transition: all .2s ease;
    }

    .button_sl {
      display: block;
      position: absolute;
      top: 0;
      bottom: -1px;
      left: -8px;
      width: 0;
      background-color: #2e77fdc0;
      transform: skew(-15deg);
      transition: all .2s ease;
    }

    .button_text {
      position: relative;
    }

    .button:hover {
      color: #0f1923;
    }

    .button:hover .button_sl {
      width: calc(100% + 15px);
    }

    .button:hover .button_lg::after {
      background-color: #fff;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.557);
    }

    /* Modal content */
    .modal-content {
      background-color: #fefefe;
      margin: 7% auto;
      /* Center vertically */
      padding: 10px;
      /* Adjust padding */
      border: 1px solid #888;
      width: 50%;
      max-width: 300px;
      /* Adjust width to your preference */
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Close button */
    .close {
      color: #aaa;
      float: right;
      font-size: 20px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    /* Style inputs and buttons inside the modal */
    .modal-content input[type=date],
    .modal-content button {
      width: calc(100% - 20px);
      /* Adjust width to accommodate padding */
      padding: 10px;
      /* Adjust padding */
      margin: 8px 0;
      box-sizing: content-box;
      border: 1px solid;
      border-radius: 4px;
      border-color: transparent;

    }

    /* Adjust button color on hover */

    .shadow__btn {
      padding: 10px 20px;
      border: none;
      font-size: 17px;
      /* color: #fff; */
      border-radius: 7px;
      letter-spacing: 4px;
      font-weight: 700;
      text-transform: uppercase;
      transition: 0.5s;
      transition-property: box-shadow;
    }

    .shadow__btn {
      background: rgb(230, 223, 223);
      box-shadow: 0 0 25px rgb(248, 248, 248);
    }

    .shadow__btn:hover {
      box-shadow: 0 0 5px rgb(172, 193, 177),
        0 0 25px rgb(182, 188, 181),
        0 0 50px rgb(182, 187, 182),
        0 0 100px rgb(193, 197, 194);
    }

    .k {
      text-align: center;
      /* Center the buttons */
      margin-top: 20px;
      /* Add top margin for spacing */
    }

    .k button {
      display: inline-block;
      /* Display buttons inline */
      margin-right: 10px;
      /* Add margin between buttons */
      width: auto;
      /* Allow buttons to adjust width based on content */
      white-space: nowrap;
      /* Prevent button text from wrapping */
      font-size: 11px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
      font-size: larger;
    }

    td {
      color: #27ae60;
    }

    tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    tbody tr:hover {
      background-color: #ddd;
    }
    #intervalSelect {
  font-family: Arial, sans-serif;
  font-size: 16px;
  padding: 8px 12px;
  border: 1px solid #ff0000;
  border-radius: 9px;
  background-color: #f8f8f8;
  color: #555;
  cursor: pointer;
  outline: none;
}

#intervalSelect:hover {
  background-color: #e0e0e0;
}

#intervalSelect:focus {
  border-color: #4d90fe;
  box-shadow: 0 0 0 2px rgba(77, 144, 254, 0.2);
}

  </style>
</head>

<body>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 col-sm-12" id="sidebar">
        <div class="sidebar-sticky text-dark">
          <h2 class="text-center">ADMIN</h2>
          <a href="/admin/home"><i class="fas fa-home"></i> Dashboard</a>
          <a href="/admin/productManagement"><i class="fas fa-box"></i> Product Management</a>
          <a href="/admin/getAllCategory"><i class="fas fa-list"></i> Category Management</a>
          <a href="/admin/userManagement"><i class="fas fa-users"></i> User Management</a>
          <a href="/admin/orderManagement"><i class="fas fa-shopping-cart"></i> Order Management</a>
          <a href="/admin/couponManagement"><i class="fas fa-percent"></i> Coupon Management</a>
          <form action="/admin/adminLogout" method="post">
            <button class="logout btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</button>
          </form>
        </div>
      </nav>

      <main role="main" class="col-md-10 col-sm-12" id="content">
        <div class="pt-3 text-center">
          <h1>I WEAR</h1>
        </div>
        <div class="dashboard-section" id="overview-section">
          <h2 class="section-title">Overview</h2>
          <button class="button mx-auto" id="open-modal-button">
            <span class="button_lg">
              <span class="button_sl"></span>
              <span class="button_text"><i class="ri-download-2-line"></i> Download Sales Report</span>
            </span>
          </button>
          <div class="row">
            <div class="col-md-4">
              <div class="statistic-box">
                <div class="statistic-icon"><i class="fas fa-users"></i></div>
                <div class="statistic-title">Users</div>
                <div class="statistic-value" id="user-count">
                  <%=count%>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="statistic-box">
                <div class="statistic-icon"><i class="fas fa-shopping-cart"></i></div>
                <div class="statistic-title">Orders</div>
                <div class="statistic-value" id="order-count">
                  <%=orders %>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="statistic-box">
                <div class="statistic-icon"><i class="fas fa-rupee-sign"></i></div>
                <div class="statistic-title">Profit</div>
                <% if(salesCount){ %>
                <div class="statistic-value" id="total-profit">₹<%=salesCount.profit %></div>
                <% }else{ %>
                  <div class="statistic-value" id="total-profit">₹0</div>
                  <% } %>
              </div>
            </div>

          </div>
          <div class="col-sm">
            <div class="statistic-box">
              <div class="statistic-icon"></div>
              <div class="statistic-title"><strong>Top Selling Products</strong></div>
              <table>
                <thead>
                  <tr>
                    <th>Product Name</th>
                    <th>Quantity Sold</th>
                  </tr>
                </thead>

                <tbody>
                  <% for(let i=0;i<topProducts.length;i++){ %>
                    <tr>
                      <td>
                        <%=topProducts[i].productName %>
                      </td>
                      <td>
                        <%=topProducts[i].totalUnitsSold %>
                      </td>
                    </tr>
                    <% } %>
                </tbody>

              </table>
            </div>
          </div>
          <div class="col-sm">
            <div class="statistic-box">
              <div class="statistic-icon"></div>
              <div class="statistic-title"><strong>Top Selling Categories</strong></div>
              <table>
                <thead>
                  <tr>
                    <th>Category Name</th>
                    <th>Quantity Sold</th>
                  </tr>
                </thead>

                <tbody>
                  <% for(let i=0;i<topCategory.length;i++){ %>
                    <tr>
                      <td>
                        <%=topCategory[i]._id %>
                      </td>
                      <td>
                        <%=topCategory[i].totalUnitsSold %>
                      </td>
                    </tr>
                    <% } %>
                </tbody>

              </table>
            </div>
          </div>

        </div>
        <select id="intervalSelect" onchange="updateChart()">
          <option value="daily" >Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
          <option value="yearly">Yearly</option>
        </select>
        <div style="width: 90%;">
          <canvas id="myChart"></canvas>
        </div>
    </div>

    </main>


    <!-- Modal -->
    <div id="date-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Select Dates</h2>
        <form action="/admin/downloadSalesReport" method="get">
          <div>
            <label for="from-date">From:</label>
            <input type="date" name="fromDate" id="from-date">
          </div>
          <div>
            <label for="to-date">To:</label>
            <input type="date" name="toDate" id="to-date">
          </div>
  
          <button type="submit" id="generate-report-button" class="shadow__btn">
            Download Report
          </button>
        </form>
        
        <div class="k">
          <a href="/admin/dailyReportDownload"><button
              style="width: fit-content; color: white; height: fit-content; background-color: rgb(0, 0, 0);"><b>Daily</b></button></a>
          <a href="/admin/weeklyReportDownload"><button
              style="width: fit-content; color: white; height: fit-content; background-color: rgb(0, 0, 0);"><b>Weekly</b></button></a>
          <a href="/admin/monthlyReportDownload"><button
              style="width: fit-content; color: white; height: fit-content; background-color: rgb(0, 0, 0);"><b>Monthly</b></button></a>
          <a href="/admin/yearlyReportDownload"><button
              style="width: fit-content; color: white; height: fit-content; background-color: rgb(0, 0, 0);"><b>Yearly</b></button></a>
        </div>

      </div>
    </div>

  </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous"></script>

    <script>
      // Function to update chart based on selected interval
      function updateChart() {
        var interval = document.getElementById('intervalSelect').value;
    
        // Making AJAX request
        $.ajax({
          type: 'POST',
          url: '/admin/chartData',
          data: { filter: interval }, 
          success: function (response) {
           
            var labels = response.label;
            var salesCount = response.salesCount;
  
            myChart.data.labels = labels;
            myChart.data.datasets[0].data = salesCount;
            myChart.update();
          },
          error: function (xhr, status, error) {
            console.error(error);
          }
        });
      }
    
      var data = {
        labels: [],
        datasets: [{
          label: 'Sales Count',
          backgroundColor: '#27ae60',
          borderColor: 'rgb(255, 99, 132)',
          data: []
        }]
      };
    
      var config = {
        type: 'bar',
        data: data,
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      };
    
      var ctx = document.getElementById('myChart').getContext('2d');
      var myChart = new Chart(ctx, config);
      updateChart();
    </script>
    
    

  <script>
    var modal = document.getElementById("date-modal");
    var btn = document.getElementById("open-modal-button");
    var span = document.getElementsByClassName("close")[0];
    btn.onclick = function () {
      modal.style.display = "block";
    }
    span.onclick = function () {
      modal.style.display = "none";
    }
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }


    document.getElementById('generate-report-button').addEventListener('click', function () {
      var fromDate = document.getElementById('from-date').value;
      var toDate = document.getElementById('to-date').value;


      console.log("Selected From Date:", fromDate);
      console.log("Selected To Date:", toDate);
      modal.style.display = "none";
    });

  </script>


  <script>
    // Get today's date in the format YYYY-MM-DD
    var today = new Date().toISOString().split('T')[0];

    // Set the max attribute of the date inputs to today's date
    document.getElementById('from-date').max = today;
    document.getElementById('to-date').max = today;
  </script>

  <!-- <script>
    function downloadSalesReport() {
      console.log("jkjkjk")
      // Extract selected dates
      var fromDate = document.getElementById('from-date').value;
      var toDate = document.getElementById('to-date').value;

      $.ajax({

        type: 'GET',
        url: `/admin/downloadSalesReport?fromDate=${fromDate}&toDate=${toDate}`,

        success: function (data) {

          const blob = new Blob([data], { type: 'text/csv' });


          const link = document.createElement('a');
          link.href = window.URL.createObjectURL(blob);
          link.download = 'sales_report.csv';


          document.body.appendChild(link);
          link.click();


          document.body.removeChild(link);
        },
        error: function (error) {
          console.error('Error downloading sales report:', error.responseText);
        }
      });
    }

  </script> -->



  <!-- <script>
    // Example data
    const userData = { count: 150 };
    const orderData = { count: 75 };
    const profitData = { total: 2500.50 }; // Example profit in dollars

    // Display data in the overview section
    document.getElementById('user-count').textContent = userData.count;
    document.getElementById('order-count').textContent = orderData.count;
    document.getElementById('total-profit').textContent = `$${profitData.total.toFixed(2)}`;
</script> -->

</body>

</html>